/*! ias 2013-04-04 */
var g2g_info={version:"v0.1"},g2g=function(t){"use strict";return t.GraphComponent=function(t,e,n,o,r){this.x=e,this.y=n,this.color=o,this.parent=t,this.g=t.append("g").attr("transform","translate("+e+","+n+")"),r&&this.g.attr("class",r)},t.GraphComponent.prototype.getXY=function(){return{x:this.x,y:this.y}},t.GraphComponent.prototype.setVisible=function(t){return this.g.style("display",t?"inline":"none"),this},t.GraphComponent.prototype.getNode=function(){return this.g},t.GraphComponent.prototype.draw=function(){return this},t.GraphComponent.prototype.select=function(){return this},t.GraphComponent.prototype.moveOnTop=function(){return this.parent.appendChild(this),this},t.Link=function(e,n,o,r){t.GraphComponent.call(this,e,0,0,o,r),this.elements=[],this.closed=!1;var a=d3.svg.area().x(function(t){return t.x}).y(function(t){return t.y}).interpolate(n),i=[];this.path=function(){return a(i)},this.addElement=function(t){var e=t.getXY();return this.elements.push(t),i.push(e),i.sort(function(t,e){return t.y-e.y}),this},this.close=function(){return this.closed?void 0:(i.push(this.elements[0].getXY()),this.closed=!0,this)}},t.Link.prototype=Object.create(t.GraphComponent.prototype),t.Link.prototype.select=function(t){return this.setVisible(t),this.elements.forEach(function(e){e.select(t)}),this},t.Link.prototype.draw=function(){return this.g.append("path").attr("d",this.path()).style("stroke",this.color),this},t.Options=function(t){if(this.listeners={},t){var e;for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}},t.Options.prototype.addListener=function(t,e){var n=Array.isArray(t)?t:[t],o=this;n.forEach(function(t){o.listeners.hasOwnProperty(t)===!1&&(o.listeners[t]=[]),e&&"function"==typeof e&&o.listeners[t].push(e)})},t.Options.prototype.getValue=function(t){return this.hasOwnProperty(t)?this[t]:void 0},t.Options.prototype.change=function(t,e){var n,o,r,a,i=t;if(t.indexOf(".")>0?(n=t.split("."),i=n[0],o=this[i][n[1]]):o=this[i],this.hasOwnProperty(i)&&o!==e&&(n?this[i][n[1]]=e:this[i]=e,this.listeners.hasOwnProperty(i)))for(a=this.listeners[i],r=0;a.length>r;r+=1)a[r].call(this,i)},t}(g2g_info),ias_info={mode:"offline",modules:[],config:{}},ias=function(t){"use strict";function e(e,n,o,r,a,i){var s;if(e)throw s="Error while loading data: "+e.message,t.showError(s),s;try{t.modules.forEach(function(t){t.init({world:n,centroids:o,networks:r,cohorts:a,unaidsinfo:i})}),t.modules.forEach(function(t){t.hasOwnProperty("run")&&t.run()}),t.showError()}catch(c){throw t.showError("Error while initializing IAS modules: "+c),c}}function n(e,n,o){var r;if(e)throw r="Error while loading data: "+e.message,t.showError(r),r;try{t.modules.forEach(function(t){t.update({networks:n,cohorts:o})}),t.showError()}catch(a){throw t.showError("Error while updating IAS modules: "+a),a}}return t.log=function(){console&&console.log&&console.log.apply(console,arguments)},t.showError=function(){d3.select("#error").text(arguments?arguments[0]:"")},t.launchApp=function(){return d3.json("./ias-config.json",function(e,n){if(e)throw"Error while loading configuration file: "+e.message;t.config=n;var o=window.top.location.search.replace("?","").split("=");t.mode=2===o.length&&"mode"===o[0]?o[1].replace("/",""):"offline",d3.select("#mode").text(t.mode+" mode"),t.loadData(t.mode)}),t},t.loadData=function(n){return queue().defer(d3.json,t.config.data.mapGeoJson).defer(d3.json,t.config.data.mapCentroids).defer(d3.json,t.config.data[n+"Networks"]).defer(d3.json,t.config.data[n+"Cohorts"]).defer(d3.json,t.config.data[n+"UnaidsInfo"]).await(e),t},t.reloadData=function(e){return queue().defer(d3.json,t.config.data[e+"Networks"]).defer(d3.json,t.config.data[e+"Cohorts"]).await(n),t},t}(ias_info);ias.util=function(){"use strict";var t={},e=d3.scale.linear(),n={},o={};return t.getNetworkColor=function(t){return n.hasOwnProperty(t)?n[t]:"white"},t.getCountryColor=function(e){var n=ias.model.getCountryById(e),o=n[ias.filter.getBackgroundInfoOption()];return t.getBackgroundColor(o)},t.getBackgroundColor=function(t){return isNaN(t)?ias.config.map.background.naColor:e(t)},t.getSelectedDomainRates=function(){return o[ias.filter.getBackgroundInfoOption()]},t.getCountryColorByFeature=function(e){var n=ias.model.getCountry(e.properties.name),o=n[ias.filter.getBackgroundInfoOption()];return t.getBackgroundColor(o)},t.getCountryId=function(t){var e=t.id;return"-99"===e?"9"+t.properties.name.substring(0,2):t.id},t.getCohortHtml=function(t){var e="<span class='tooltip title'>Cohort</span><h1 class='tooltip'>"+t.name+":</h1>";return e+="<b>Number of subjects:</b>&nbsp;"+t.size+"<br>",e+="<b>Network:&nbsp;</b>"+t.getNetwork()+"<br>",e+="<b>Status:</b>&nbsp;"+t.status+"<br>",e+="<b>Countries:</b>&nbsp;",e+=t.getCountries().map(function(t){return t.name}).join(", ")+"<br>",e+="<b>Objectives:&nbsp;</b>",e+="<span class='tooltip objectives'>"+t.objectives+"</span>",e+="<br><br><a class='tooltip' target='_blank' href='"+ias.config.map.cohort.fullProfile.replace("$code$",t.code)+"'>View Full Profile</a>"},t.getCountryHtml=function(t){var e="<span class='tooltip title'>Country   "+t.id+"</span><h1 class='tooltip'>"+t.name+"</h1><table>",n="white";return e+="<tr><td class='firstcol'>HIV Prevalence Rate</td><td class='secondcol'>",e+=(t.hivPrevalenceRate||"na")+" %</td></tr>",e+="<tr><td>ARV Coverage Rate</td><td class='secondcol'>",e+=(t.arvCoverageRate||"na")+" %</td></tr>",t.cohorts&&t.cohorts.length>0&&(e+="<tr><td colspane='2'><br><b>COHORTS:</b></td></tr>",t.cohorts.forEach(function(t){n=ias.util.getNetworkColor(t.networks[0]),e+="<tr><td class='firstcol'><span style='background:",e+=n+";'>&nbsp;&nbsp;&nbsp;</span>&nbsp;",e+=t.name+"</td><td class='secondcol'>",e+=t.size+"</td></tr>"}),e+="<tr><td class='firstcol' style='text-align:right;'><b>Total</b></td><td class='secondcol'><b>",e+=t.size+"</b></td></tr>"),e+="</table>"},t.init=function(e){var r,a,i;a=e.networks.map(function(t){return t.code}),i=d3.scale.category20c().domain(a),a.forEach(function(t){n[t]=i(t)}),r=e.unaidsinfo.filter(function(t){return!isNaN(t.hiv)}).map(function(t){return parseFloat(t.hiv)}),o.hivPrevalenceRate=[d3.min(r),d3.max(r)],r=e.unaidsinfo.filter(function(t){return!isNaN(t.arv)}).map(function(t){return parseFloat(t.arv)}),o.arvCoverageRate=[d3.min(r),d3.max(r)],t.initBackgroundColors()},t.initBackgroundColors=function(){e.domain(t.getSelectedDomainRates()),e.range(ias.config.map.background[ias.filter.getBackgroundInfoOption()])},t.update=function(){},ias.modules.push(t),t}(),ias.filter=function(){"use strict";function t(t,e){var n=d3.select("#"+t).selectAll("input").data(e).enter().append("div");n.append("input").attr("checked",!0).attr("type","checkbox").attr("id",function(e){return t+e}).attr("value",function(t){return t}).attr("selected","selected"),n.append("label").attr("for",function(e){return t+e}).attr("class",t).text(function(t){return t})}var e,n,o={},r={},a=[],i={};for(e=1980;2013>=e;e+=1)a.push(e);return o.BACKGROUND_INFO="backgroundInfo",o.YEAR="year",o.NETWORKS="networks",o.ENROLLMENT_STATUS="enrollmentStatus",o.AGE_GROUP="ageGroup",i[o.BACKGROUND_INFO]="hivPrevalenceRate",i[o.YEAR]="1980",i[o.NETWORKS]={},i[o.ENROLLMENT_STATUS]="All",i[o.AGE_GROUP]="All",n=new g2g.Options(i),o.getValue=function(t){return n.getValue(t)},o.getBackgroundInfoOption=function(){return o.getValue(o.BACKGROUND_INFO)},o.addListener=function(t,e){n.addListener(t,e)},d3.select("#backgroundInfo").on("change",function(){var t=this.options[this.selectedIndex].value;n.change(o.BACKGROUND_INFO,t)}),d3.select("#year").on("change",function(){var t=parseInt(this.options[this.selectedIndex].value,10);n.change(o.YEAR,t)}).selectAll("option").data(a).enter().append("option").attr("value",function(t){return t}).text(function(t){return t}),o.init=function(e){function a(t,e){var r=e.code;n.change(o.NETWORKS+"."+r,t.checked)}var i;r=ias.config.filter,d3.select("#mapInfo").text("version: "+ias.config.version+" - "+ias.config.timestamp+"  ("+ias.mode+")"),d3.select("#status").on("change",function(){var t=this.options[this.selectedIndex].value;n.change(o.ENROLLMENT_STATUS,t)}).selectAll("option").data(r.enrollmentStatus).enter().append("option").attr("value",function(t){return t}).text(function(t){return t}),t("ageGroup",r.ageGroup),t("subjectStatus",r.subjectStatus),e.networks.sort(function(t,e){return d3.ascending(t.code,e.code)});var s=Math.round(e.networks.length/2),c=[e.networks.slice(0,s),e.networks.slice(s,e.networks.length)];c.forEach(function(t,e){t.forEach(function(t){n.networks[t.code]=!0}),i=d3.select("#net"+(e+1)).selectAll("div").data(t).enter().append("div").attr("class","network"),i.append("input").attr("checked",!0).attr("class","network").attr("type","checkbox").attr("id",function(t){return"n"+t.code}).on("click",function(t){return a(this,t)}),i.append("span").text("__").style("color",function(t){return ias.util.getNetworkColor(t.code)}).style("background",function(t){return ias.util.getNetworkColor(t.code)}),i.append("label").attr("class","network").attr("for",function(t){return"n"+t.code}).text(function(t){return" "+t.name})})},o.update=function(){},ias.modules.push(o),o}(),ias.model=function(){"use strict";var t={worldJson:{},networks:{},allcountries:[],allcountriesByName:{},allcountriesById:{},countriesWithCohorts:[],cohorts:[]};return t.getCountry=function(e){var n=t.allcountriesByName[e];return n},t.getCountryById=function(e){var n=t.allcountriesById[e];return n},t.init=function(e){t.worldJson=e.world,t.networks=e.networks.children,t.worldJson.features.forEach(function(e){var n=new ias.model.Country(e);t.allcountries.push(n),t.allcountriesByName[n.name]=n,t.allcountriesById[n.id]=n}),e.unaidsinfo.forEach(function(e){var n=t.allcountriesByName[e.name];void 0!==n?(n.hivPrevalenceRate=parseFloat(e.hiv),n.arvCoverageRate=parseFloat(e.arv)):ias.log("HIV/ARV Rates: no country found for "+e.name)}),e.cohorts.forEach(function(e){var n=new ias.model.Cohort(e);t.cohorts.push(n)}),t.allcountries.forEach(function(e){e.numberOfCohorts()>0&&t.countriesWithCohorts.push(e)})},t.update=function(){},ias.modules.push(t),t}(),ias.model=function(t){"use strict";return t.Cohort=function(e){this.status=e.status,this.code=e.code,this.name=e.name,this.objectives=e.objectives,this.year=e.year,this.size=e.size,this.networks=e.networks,this.countryData={};var n=this;e.countries.forEach(function(o){var r=t.allcountriesById[o.trim()];r?(n.addCountryData(r.id,10,r),r.addCohort(n),r.addNetwork(e.networks[0])):ias.log("Cohort country not found for "+o)})},t.Cohort.prototype.getCountryData=function(t){return this.countryData[t]},t.Cohort.prototype.getCountries=function(){var t=[];for(var e in this.countryData)this.countryData.hasOwnProperty(e)&&t.push(this.countryData[e].country);return t},t.Cohort.prototype.getCountryIds=function(){return Object.keys(this.countryData)},t.Cohort.prototype.addCountryData=function(t,e,n){var o=Object.create(ias.model.CountryData);o.countryId=t,o.size=e,o.country=n,this.countryData[t]=o,this.numberOfCountries+=1},t.Cohort.prototype.getNetwork=function(){return this.networks[0]},t}(ias.model||{}),ias.model=function(t){"use strict";return t.Country=function(t){this.feature=t,this.networks={},this.cohorts=[],this.hivPrevalenceRate="na",this.arvCoverageRate="na",this.size=0,this.id=t.id,"-99"===this.id&&(this.id="9"+t.properties.name.substring(0,2)),this.name=this.feature.properties.name},t.Country.prototype.addNetwork=function(t){this.networks.hasOwnProperty(t)===!1&&(this.networks[t]=t)},t.Country.prototype.getNetworks=function(){return Object.keys(this.networks)},t.Country.prototype.numberOfCohorts=function(){return this.cohorts?this.cohorts.length:0},t.Country.prototype.addCohort=function(t){return this.cohorts.push(t),this.size+=t.size,this},t.Country.prototype.getCohortIds=function(){var t=[];return this.cohorts&&this.cohorts.length>0&&this.cohorts.forEach(function(e){t.push(e.code)}),t},t}(ias.model||{}),ias.model=function(t){"use strict";return t.CountryData={countryId:"",size:0,country:null},t}(ias.model||{}),ias.graph=function(){"use strict";var t={components:[],tooltip:{country:{},cohort:{}}};return t.projection=d3.geo.miller().precision(.1).scale(153),t.path=d3.geo.path().projection(t.projection),t.init=function(e){var n,o,r,a,i={};n=d3.select("#map").append("svg").attr("class","map").attr("width",ias.config.map.width).attr("height",ias.config.map.height),o=d3.select("#legend").append("svg").attr("class","legend").attr("width",ias.config.legend.width).attr("height",ias.config.legend.height),r=d3.select("#title").append("svg").attr("class","title").attr("width",360).attr("height",50),a=d3.select("#zoom").append("svg").attr("class","zoom").attr("width",180).attr("height",60),t.zoom=ias.graph.zoom(a),t.components.push(t.zoom),t.map=ias.graph.map(n),t.components.push(t.map),t.legend=ias.graph.legend(o),t.components.push(t.legend),t.components.push(ias.graph.title(r)),e.centroids.forEach(function(t){i[t.id]=t.ll}),t.tooltip.country=ias.graph.tooltip("tooltipCountry",ias.config.map.tooltip.country,"","country"),t.tooltip.cohort=ias.graph.tooltip("tooltipCohort",ias.config.map.tooltip.cohort,"","cohort"),ias.model.countriesWithCohorts.forEach(function(e){var n=[],o=i[e.name];n=o===void 0?t.path.centroid(e.feature):t.projection(o),e.centroidx=n[0],e.centroidy=n[1]})},t.update=function(){},t.run=function(){t.components.forEach(function(t){t.draw()})},ias.modules.push(t),t}(),ias.graph=function(t){"use strict";function e(t,e,n){var o=n?.15:.9,r=n?"black":"#333",a=n?"bold":"normal";t.parent.selectAll("circle.cohort:not(."+e.cssIdClass+")").style("opacity",o),t.parent.selectAll("g.country.pin:not(."+e.cssIdClass+")").style("opacity",o),t.parent.selectAll("circle.country.pin."+e.cssIdClass).style("stroke",r),t.parent.selectAll("text.country.pin."+e.cssIdClass).style("fill",r).style("font-weight",a),t.parent.selectAll("text.country.pin.subjects."+e.cssIdClass).style("display",n?"none":"inline")}function n(t,n){n.cohorts||e(t,n,!0)}function o(t,n){n.cohorts||e(t,n,!1)}function r(t,n){d3.event.stopPropagation(),n.cohorts||(ias.graph.map.select(n),e(t,n,!0))}return t.CountryPin=function(t,e){this.country=e,this.maxRadius=20,this.minRadius=5,this.scale=d3.scale.sqrt().domain([0,3e5]).range([this.minRadius,this.maxRadius]),this.radius=this.scale(this.country.size),this.pack=d3.layout.pack().size([this.radius,this.radius]).value(function(t){return t.size}).children(function(t){return t.cohorts}),this.nodes=this.pack.nodes(this.country);var n="";this.country.cohorts.forEach(function(t){t.cssIdClass="c"+t.code,n+=" "+t.cssIdClass}),this.classes="pin country"+n,g2g.GraphComponent.call(this,t,this.country.centroidx-this.radius/2,this.country.centroidy-this.radius/2,ias.util.getCountryColor(this.country.id),this.classes)},t.CountryPin.prototype=Object.create(g2g.GraphComponent.prototype),t.CountryPin.prototype.filter=function(){var t=ias.filter.getValue(ias.filter.NETWORKS),e=ias.filter.getValue(ias.filter.ENROLLMENT_STATUS),n=this;return this.country.cohorts.forEach(function(o){var r=t[o.getNetwork()];r&="All"===e||o.status===e,n.g.select("#"+n.country.id+"-"+o.code).style("display",r?"inline":"none")}),this},t.CountryPin.prototype.draw=function(){var t=this.g.selectAll("circle").data(this.nodes).enter(),e=this;return t.append("svg:circle").attr("class",function(t){return t.cohorts?e.classes:"cohort "+t.getNetwork()+" "+t.cssIdClass}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return t.r}).attr("id",function(t){return e.country.id+"-"+t.code}).style("fill",function(t){return t.cohorts?"gray":ias.util.getNetworkColor(t.getNetwork())}).on("mouseover",function(t){n(e,t)}).on("mouseout",function(t){o(e,t)}).on("click",function(t){r(e,t)}),this.g.append("svg:text").attr("x",this.country.x).attr("y",this.country.y-1*this.radius/2).attr("dy","-.3em").attr("text-anchor","middle").attr("class",this.classes).text(this.country.name),this},t}(ias.graph||{}),ias.graph=function(t){"use strict";return t.legend=function(t){function e(){var t=ias.util.getSelectedDomainRates();f.tickValues(t),u.selectAll("stop").data(d).enter().append("svg:stop").attr("offset",function(t){return t+"%"}).attr("stop-color",function(e){return t[0]>e||e>t[1]?"white":ias.util.getBackgroundColor(e)}).attr("stop-opacity",1),c.append("g").attr("class","x axis").attr("transform","translate(10, 25)").call(h),c.append("g").attr("class","x axis selected").attr("transform","translate(10, 45)").call(f),c.append("svg:rect").attr("class","legend").attr("y",25).attr("x",10).attr("width",120).attr("height",20).style("fill","url(#gradient)").style("stroke","#000").style("stroke-width",".3px"),c.append("rect").attr("class","legend").attr("x",145).attr("y",25).attr("width",20).attr("height",20).style("stroke","#000").style("stroke-width",".3px").style("fill",ias.config.map.background.naColor).attr("dx",-3).attr("dy",".35em"),c.append("text").attr("x",150).attr("y",15).attr("class","legend background").text("n/a"),c.append("text").attr("x",10).attr("y",0).attr("id","backgroundInfoTitle").attr("class","title legend").text(ias.config.legend.hivPrevalenceRate)}function n(){var t=ias.config.legend.cohorts,e=d3.scale.sqrt().domain([0,3e5]).range([2,15]);l.selectAll("circle").data(t).enter().append("circle").attr("cx",20).attr("cy",function(t){return 50-e(t)}).style("fill","none","opacity",1).style("stroke",ias.config.map.cohort.linkcolor).style("stroke-width","1px").attr("r",function(t){return e(t)}),l.selectAll("text").data(t).enter().append("text").attr("y",function(t){return 50-2*e(t)+4}).attr("x",40).attr("class","legend").text(function(t,e){return 4===e?">"+t:t}),c.append("text").attr("x",200).attr("y",0).attr("class","title legend").text("Cohort Size")}function o(){e(),n()}function r(){}function a(){var t=ias.filter.getBackgroundInfoOption();c.select("#backgroundInfoTitle").text(ias.config.legend[t]);var e=ias.util.getSelectedDomainRates();f.tickValues(e),c.select(".x.axis.selected").call(f),u.selectAll("stop").attr("offset",function(t){return t+"%"}).attr("stop-color",function(t){return e[0]>t||t>e[1]?"white":ias.util.getBackgroundColor(t)}).attr("stop-opacity",1)}for(var i=0,s=20,c=t.append("g").attr("id","blegend").attr("transform","translate("+i+","+s+")"),l=t.append("g").attr("id","clegend").attr("transform","translate("+(i+200)+","+s+")"),u=t.append("svg:defs").append("svg:linearGradient").attr("id","gradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").attr("spreadMethod","pad"),d=[],p=d3.scale.linear().domain([0,100]).range([0,120]),h=d3.svg.axis().scale(p).orient("top").ticks(5),f=d3.svg.axis().scale(p).orient("bottom"),g=0;100>g;g++)d[g]=g;return ias.filter.addListener(ias.filter.BACKGROUND_INFO,a),{draw:o,update:r,filterUpdate:a}},t}(ias.graph||{}),ias.graph=function(t){"use strict";return t.map=function(t){function e(t,e){var n="translate("+e.join(",")+")";n+="scale("+t+")",f.attr("transform",n),f.selectAll("path").attr("d",ias.graph.path.projection(ias.graph.projection)),g.attr("transform",n)}function n(t){var e;d3.event.stopPropagation(),t&&(e=ias.graph.path.centroid(t),o(t))}function o(t){var e=ias.util.getCountryId(t),n=ias.model.allcountriesById[e];m.select(n)}function r(){m.reset()}function a(){t.append("path").datum(d3.geo.graticule()).attr("class","graticule").attr("d",ias.graph.path),t.on("mousedown",i).on("mouseup",s).on("click",r),f.selectAll("path").data(ias.model.worldJson.features).enter().append("path").attr("class","country").attr("d",ias.graph.path).attr("pointer-events","fill").style("fill",function(t){return ias.util.getCountryColorByFeature(t)}).attr("id",function(t){return ias.util.getCountryId(t)}).style("opacity",ias.config.map.background.opacity).on("click",n),f.select("#ATA").remove(),ias.model.countriesWithCohorts.forEach(function(t){var e=new ias.graph.CountryPin(g,t).draw();y.push(e)})}function i(){t.style("cursor","move")}function s(){t.style("cursor","pointer")}function c(){}function l(t){return t===ias.filter.BACKGROUND_INFO?(ias.util.initBackgroundColors(),f.selectAll("path").style("fill",function(t){return ias.util.getCountryColorByFeature(t)}),void 0):(y.forEach(function(t){t.filter()}),void 0)}function u(){function t(t){return t&&"Cohort"===t.constructor.name?(n(t),o(null),void 0):t&&"Country"===t.constructor.name?(n(null),o(t),void 0):void 0}function e(){n(null),o(null)}function n(t){a!==t&&(a&&g.selectAll("circle.cohort."+a.cssIdClass).classed("selected",!1),a=t,a?(ias.graph.tooltip.cohort.html(ias.util.getCohortHtml(a)).show(),g.selectAll("circle.cohort."+a.cssIdClass).classed("selected",!0)):ias.graph.tooltip.cohort.hide())}function o(t){if(r!==t)if(r&&d3.select("#"+r.id).style("stroke","#000").style("stroke-width","0.1px"),r=t){ias.graph.tooltip.country.html(ias.util.getCountryHtml(r)).show();try{d3.select("#"+r.id).style("stroke","darkred").style("stroke-width","0.5px")}catch(e){}}else ias.graph.tooltip.country.hide()}var r,a;return{select:t,reset:e}}var d=-60,p=120,h=t.append("g").attr("id","mapcontainer").attr("transform","translate("+d+","+p+")"),f=h.append("g").attr("id","map").attr("class","map"),g=h.append("g").attr("id","pins_country").attr("class","pin country"),y=[],m=u();return ias.filter.addListener([ias.filter.NETWORKS,ias.filter.YEAR,ias.filter.ENROLLMENT_STATUS,ias.filter.BACKGROUND_INFO],l),ias.graph.zoom.register(t,e,[d,p]),{draw:a,update:c,filterUpdate:l,select:m.select}},t}(ias.graph||{}),ias.graph=function(t){"use strict";return t.title=function(t){function e(){a.append("text").attr("x",0).attr("y",0).attr("class","graphtitle").text(ias.config.title)}function n(){}var o=10,r=30,a=t.append("g").style("pointer-events","none").attr("transform","translate("+o+","+r+")");return{draw:e,update:n}},t}(ias.graph||{}),ias.graph=function(t){"use strict";return t.tooltip=function(t,e,n,o){var r={},a=d3.select("body").append("div").attr("class","tooltip "+(o||"")).attr("id",t).style("left",e[0]+"px").style("top",e[1]+"px").style("opacity",0).html(n);return r.show=function(){return a.transition().duration(100).style("opacity",1),r},r.hide=function(){return a.transition().duration(200).style("opacity",0),r},r.html=function(t){return a.html(t),r},r.style=function(t,e){return a.style(t,e),r},r.move=function(t){return a.style("left",t[0]+"px").style("top",t[1]+"px"),r},r},t}(ias.graph||{}),ias.graph=function(t){"use strict";return t.zoom=function(t){function e(t,e,n,o){u.append("image").attr("xlink:href","images/"+t+".png").attr("width",20).attr("height",20).attr("x",e).attr("y",n).attr("id",t).style("cursor","pointer").style("opacity",function(){return o?o:.2}).style("pointer-events",function(){return o?"all":"none"}).on("click",function(){s[t]()})}function n(){e("zoomin",50,20,1),e("zoomout",25,20),e("moveup",-20,10),e("movedown",-20,30),e("moveleft",-35,20),e("moveright",-5,20),u.append("text").attr("x",80).attr("y",32).attr("id","zoomFactor").text("scale:1")}function o(){}function r(t,e,n){s=i(t,e,n)}function a(t){u.selectAll("#moveup, #movedown, #moveright, #moveleft, #zoomout").style("opacity",1===t?"0.2":"1").style("pointer-events",1===t?"none":"all"),u.select("#zoomin").style("opacity",6>t?"1":"0.2").style("pointer-events",6>t?"all":"none"),u.select("#zoomFactor").text("scale:"+t.toFixed(1))}function i(t,e,n){function o(){var t=u,o=1;2>=t?u=1:4>=t?(u=2,o=2):6>=t&&(u=4,o=2),f.scale(u),1===u?(d[0]=0,d[1]=0):(d[0]+=o*(p/2-n[0]),d[1]+=o*(h/2-n[1])),f.translate(d),e(u,d),a(u)}function r(){var t=u,o=1;2>t?u=2:4>t?(u=4,o=2):6>t&&(u=6,o=2),f.scale(u),d[0]-=o*(p/2-n[0]),d[1]-=o*(h/2-n[1]),f.translate(d),e(u,d),a(u)}function i(){d[1]-=10,f.translate(d),e(u,d)}function s(){d[1]+=10,f.translate(d),e(u,d)}function c(){d[0]+=10,f.translate(d),e(u,d)}function l(){d[0]-=10,f.translate(d),e(u,d)}var u=1,d=[0,0],p=ias.config.map.width,h=ias.config.map.height,f=(ias.graph.projection([0,0]),d3.behavior.zoom().scaleExtent([1,6]).on("zoom",function(){u=d3.event.scale,d=d3.event.translate,e(u,d),a(u)}));return t.call(f),{zoomin:r,zoomout:o,moveleft:l,moveright:c,moveup:i,movedown:s}}var s,c=50,l=0,u=t.append("g").attr("id","buttons").style("pointer-events","none").attr("transform","translate("+c+","+l+")");return{draw:n,update:o,register:r}},t}(ias.graph||{}),ias.launchApp();